@{
    ViewData["Title"] = "Home Page";
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>

<link href="https://cdn.datatables.net/v/dt/dt-2.0.2/datatables.min.css" rel="stylesheet">
<script src="https://cdn.datatables.net/v/dt/dt-2.0.2/datatables.min.js"></script>

<div class="container">
    <div class="row">
        <div class="col">
            <h5>Customer Table</h5>
            <table id="table_customers" class="ui olive celled table">
                <thead>
                    <tr>
                        <th style="width:13%;"><font>Id</font></th>
                        <th style="width:13%;"><font>FirstName</font></th>
                        <th style="width:13%;"><font>SurName</font></th>
                        <th style="width:13%;"><font>Age</font></th>
                        <th style="width:13%;"><font>Email</font></th>
                        <th style="width:13%;"><font>Created Date</font></th>
                        <th style="width:13%;"><font>Last Modified Date</font></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<!-- VIEW ADDITIONAL BOOK INFO MODAL -->
<div id="modal_viewAdditionalBookInfo" class="ui modal">
    <div class="header">
        <font>View Additional Book Info</font>
        <i class="ui close icon modal-cross" style="float: right; cursor: pointer;"></i>
    </div>
    <div class="content">
    </div>
    <div class="actions footer">
        <div class="ui deny default button">
            <i class="ui close icon"></i>&nbsp;
            <font>Close</font>
        </div>
    </div>
</div>

<script>
    var customerTable;

    customerTable = $("#table_customers").DataTable({
        "deferRender": true,
        "columnDefs": [{
            "searchable": false,
            "orderable": false,
            "targets": [7]
        }]
    });

    $(document).ready(function () {
        LoadCustomerTable();
    });

    function LoadCustomerTable() {
        $.ajax({
            type: 'GET',
            url: 'https://localhost:7101/CustomerManagement/GetCustomers',
            dataType: 'json',
            success: function (data) {
                customerTable.clear();
                for (var i = 0; i < data.length; i++) {
                    customerTable.row.add([
                        data[i].id,
                        data[i].firstName,
                        data[i].surName,
                        data[i].age,
                        data[i].email,
                        new Date(data[i].created).toLocaleString(),
                        new Date(data[i].lastUpdated).toLocaleString(),
                        "<button data-id='" + data[i].id + "' class='btn btn-primary view_edit_btn'><font>Edit Customer</font></button>" +
                        "<button data-id='" + data[i].id + "' class='btn btn-primary view_delete_btn'><font>Delete Customer</font></button>" +
                        "<button data-id='" + data[i].id + "' class='btn btn-primary view_customer_btn'><font>View Customer</font></button>"
                    ]);
                }

                customerTable.draw();
            },
            error: function (data) {
                alert(data.responseText);
            }
        });
    }


    $(document).on("click", "button.view_delete_btn", function () {
        var btnId = $(this).data("id");
        $.ajax({
            type: 'DELETE',
            url: 'https://localhost:7101/CustomerManagement/DeleteCustomer?customerId=' + btnId,
            dataType: 'json',
            success: function (data) {
                LoadCustomerTable();
            },
            error: function (data) {
                alert(data.responseText);
            }
        });
    })
</script>
